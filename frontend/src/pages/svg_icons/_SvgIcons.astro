---
import CreditsButton from '@/components/buttons/CreditsButton';
import Pagination from '@/components/PaginationComponent.astro';
import ToolContainer from '@/components/tool/ToolContainer';
import ToolContentCardWrapper from '@/components/tool/ToolContentCardWrapper';
import ToolHead from '@/components/tool/ToolHead';
import { Card } from '@/components/ui/card';
import { formatNumber } from '@/lib/utils';
import { getIconsByCluster } from 'db/svg_icons/svg-icons-utils';
import { Download, Filter, Star } from 'lucide-react';
import AdBanner from '../../components/banner/AdBanner.astro';

const {
  categories,
  currentPage,
  totalPages,
  totalCategories,
  totalSvgIcons,
  breadcrumbItems,
} = Astro.props;
---

<ToolContainer>
  <div class="mb-16 mt-[74px]">
    <AdBanner />
  </div>
  <ToolHead
    name="SVG Icons"
    description="Download thousands of free SVG icons instantly. Edit colors, add backgrounds, and customize vector graphics for your projects. No registration required."
    breadcrumbItems={breadcrumbItems}
  />

  <!-- Overview Stats -->
  <div id="pagination-info" class="text-center">
    <div class="grid grid-cols-2 gap-6 mt-8">
      <div class="text-center">
        <div class="text-3xl font-bold text-blue-600">{totalCategories}</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Categories</div>
      </div>
      <div class="text-center">
        <div class="text-3xl font-bold text-green-600">
          {formatNumber(totalSvgIcons)}
        </div>
        <div class="text-sm text-gray-600 dark:text-gray-400">SVG Icons</div>
      </div>
    </div>
  </div>

  <!-- Pagination Info -->
  <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 mb-6 mt-8">
    <div class="text-sm text-slate-600 dark:text-slate-400 text-center">
      Showing {categories.length} of {totalCategories} categories (Page {
        currentPage
      } of {totalPages})
    </div>
  </div>

  <!-- Categories Grid -->
  <div class="mt-10 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {
        categories.map((category: any) => {
          // Get base64 icons from database for this category
          // Use category.id (source_folder) which is the actual cluster key in the database
          const dbIcons = getIconsByCluster(category.id || category.name) || [];
          const previewIcons = dbIcons.slice(0, 6);

          const iconPreviews = previewIcons
            .map((icon: any) => {
              const iconName = icon.name.replace('.svg', '');
              return `
                <div class="flex items-center justify-center p-1">
                  <div class="w-14 h-14 text-slate-600 overflow-hidden flex items-center justify-center">
                    <div class="w-14 h-14 flex items-center justify-center bg-slate-100 rounded-lg">
                      <img 
                        src="data:image/png;base64,${icon.base64}" 
                        alt="${iconName} icon"
                        class="w-10 h-10 object-contain"
                        loading="lazy"
                      />
                    </div>
                  </div>
                </div>
              `;
            })
            .join('');

          const remainingSlots = Math.max(0, 6 - previewIcons.length);
          const emptySlots = Array(remainingSlots)
            .fill(0)
            .map(
              () =>
                '<div class="flex items-center justify-center p-1"><div class="w-14 h-14"></div></div>'
            )
            .join('');

          return (
            <a
              href={category.url}
              class="block bg-white dark:bg-slate-900 dark:border-slate-900 border border-slate-200 rounded-xl p-6 pb-20 shadow-sm hover:shadow-md transition-all duration-200"
            >
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-slate-900 dark:text-white capitalize">
                  {category.name.replace('-', ' ')}
                </h3>
                <span class="text-sm text-slate-500 font-medium">
                  {category.iconCount} ICONS
                </span>
              </div>

              <div
                class="grid grid-cols-3 gap-2 gap-y-3 w-full h-20"
                set:html={`${iconPreviews}${emptySlots}`}
              />
            </a>
          );
        })
      }
    </div>
  </div>

  <!-- Pagination. -->
  <Pagination
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/freedevtools/svg_icons/"
  />

  <!-- Features -->
  <div class="mb-10 mt-6">
    <ToolContentCardWrapper>
      <Card className="p-6">
        <h2 class="text-xl font-semibold mb-6 text-center">
          Why Use Our SVG Icons?
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="text-center space-y-2">
            <Download className="h-8 w-8 text-blue-600 mx-auto" />
            <h3 class="font-semibold">Instant Download</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Download SVG icons instantly without registration or signup
              required.
            </p>
          </div>
          <div class="text-center space-y-2">
            <Filter className="h-8 w-8 text-green-600 mx-auto" />
            <h3 class="font-semibold">Easy Customization</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Edit colors, add backgrounds, and customize vector graphics for
              your projects.
            </p>
          </div>
          <div class="text-center space-y-2">
            <Star className="h-8 w-8 text-yellow-600 mx-auto" />
            <h3 class="font-semibold">High Quality</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Professional vector graphics that scale perfectly for any screen
              size.
            </p>
          </div>
        </div>
      </Card>
    </ToolContentCardWrapper>
  </div>

  <!-- Credits Section -->
  <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
    <div class="flex flex-wrap gap-4">
      <a
        href="/freedevtools/"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
      >
        ‚Üê Back to Free DevTools
      </a>
      <CreditsButton href="/freedevtools/svg_icons/credits/" />
    </div>
  </div>
</ToolContainer>

<style>
  .icon-preview svg {
    width: 100% !important;
    height: 100% !important;
    max-width: 64px;
    max-height: 64px;
    display: block;
    object-fit: contain;
  }

  .icon-preview {
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>
