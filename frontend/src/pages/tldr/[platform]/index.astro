---
import { getCollection } from 'astro:content';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getTldrPlatformCommands } from '../../../lib/tldr-utils';
import TldrPlatform from '../_TldrPlatform.astro';

// Test comment with bad spacing    and formatting

// Generate static paths for all platforms
export async function getStaticPaths() {
  const tldrEntries = await getCollection('tldr');
  const platforms = new Set<string>();

  for (const entry of tldrEntries) {
    const pathParts = entry.id.split('/');
    const platform = pathParts[pathParts.length - 2];
    platforms.add(platform);
  }

  return Array.from(platforms).map((platform) => ({
    params: { platform },
  }));
}

const { platform } = Astro.params;

// Get all commands for this platform
const allCommands = await getTldrPlatformCommands(platform!);

// Pagination logic for page 1
const itemsPerPage = 30;
const currentPage = 1;
const totalPages = Math.ceil(allCommands.length / itemsPerPage);
const startIndex = (currentPage - 1) * itemsPerPage;
const endIndex = startIndex + itemsPerPage;
const commands = allCommands.slice(startIndex, endIndex);
const totalCommands = allCommands.length;

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'TLDR', href: '/freedevtools/tldr/' },
  { label: platform },
];

// SEO data
const seoTitle = `${platform} Commands - TLDR Documentation | Online Free DevTools by Hexmos`;
const seoDescription = `Comprehensive documentation for ${platform} command-line tools. Learn ${platform} commands quickly with practical examples. ${totalCommands} commands available.`;
const canonical = `https://hexmos.com/freedevtools/tldr/${platform}/`;

// Enhanced keywords for platform page
const platformKeywords = [
  `${platform} commands`,
  `${platform} cli`,
  `${platform} documentation`,
  'command line',
  'cli documentation',
  'terminal commands',
  'command reference',
  'cli documentation',
];
---

<BaseLayout
  name={`${platform} Commands`}
  path={`/freedevtools/tldr/${platform}/`}
  title={seoTitle}
  description={seoDescription}
  canonical={canonical}
  showHeader={true}
  totalItems={totalCommands}
  itemsPerPage={itemsPerPage}
  currentPage={currentPage}
  category={`${platform} Commands`}
  partOf="TLDR"
  partOfUrl="https://hexmos.com/freedevtools/tldr/"
  keywords={platformKeywords}
  features={[
    'Quick Reference',
    'Platform Specific',
    'Practical Examples',
    'No Registration',
  ]}
>
  <TldrPlatform
    commands={commands}
    currentPage={currentPage}
    totalPages={totalPages}
    totalCommands={totalCommands}
    platform={platform}
    breadcrumbItems={breadcrumbItems}
  />
</BaseLayout>
