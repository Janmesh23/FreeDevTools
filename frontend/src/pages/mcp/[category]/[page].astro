---
import CreditsButton from '@/components/buttons/CreditsButton';
import ToolContainer from '@/components/tool/ToolContainer';
import ToolHead from '@/components/tool/ToolHead';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { generateMcpCategoryPaginatedPaths } from '@/lib/mcp-utils';
import { formatRepositoryName } from '@/lib/utils';
import { getEntry } from 'astro:content';
import AdBanner from '../../../components/banner/AdBanner.astro';
import Pagination from '../../../components/PaginationComponent.astro';
import RepositoryCard from '../_McpRepoCard.astro';

// Generate static paths for all MCP categories with pagination
export async function getStaticPaths({ paginate }) {
  return await generateMcpCategoryPaginatedPaths({ paginate });
}

// Get category and page from params
const { category } = Astro.params;
const { page } = Astro.props;

if (!category) {
  throw new Error('Category parameter is required');
}

// Get category data
const categoryEntry = await getEntry('mcpCategoryData', category);

if (!categoryEntry) {
  throw new Error(`Category '${category}' not found`);
}

const categoryData = categoryEntry.data;
const categoryName = categoryData.categoryDisplay;
const categoryDescription = categoryData.description || '';

// SEO data
const title = `${categoryName} MCP Servers & Repositories – ${page.total} Model Context Protocol Tools (Page ${page.currentPage} of ${page.lastPage}) | Free DevTools by Hexmos`;

const description = `Discover ${page.total} ${categoryName} MCP servers and repositories for Model Context Protocol integrations. Browse tools compatible with Claude, Cursor, and Windsurf — free, open source, and easy to explore.`;

const keywords = [
  'MCP',
  'Model Context Protocol',
  categoryName,
  'MCP servers',
  'AI tools',
  'developer tools',
  'open source',
  'repositories',
  'pagination',
];

// Breadcrumb data
const breadcrumbItems = [
  { label: 'Free DevTools', href: '/freedevtools/' },
  { label: 'MCP Directory', href: '/freedevtools/mcp/1/' },
  { label: categoryName, href: `/freedevtools/mcp/${category}/1/` },
];
---

<BaseLayout
  name={`${categoryName} MCP Repositories`}
  title={title}
  path={`/freedevtools/mcp/${category}/1/`}
  description={description}
  canonical={`https://hexmos.com/freedevtools/mcp/${category}/${page.currentPage}/`}
  keywords={keywords}
  ogImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  twitterImage="https://hexmos.com/freedevtools/tool-banners/mcp-directory-banner.png"
  datePublished="2025-01-30"
  softwareVersion="1.0.0"
  features={[
    `Browse ${page.total} MCP repositories in ${categoryName}`,
    'Filter by license and quality scores',
    'Search and sort functionality',
    'Detailed repository information',
    'Pagination support',
  ]}
>
  <ToolContainer>
    <div class="mb-16 mt-[74px]">
      <AdBanner />
    </div>
    <ToolHead
      name={`${categoryName} MCP Repositories`}
      description={`${page.total} repositories in this category. ${categoryDescription}`}
      breadcrumbItems={breadcrumbItems}
    />

    <!-- Pagination Info - Top -->
    <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 mb-6 mt-6">
      <div class="text-sm text-slate-600 dark:text-slate-400 text-center">
        Showing {page.data.length} of {page.total} repositories (Page {
          page.currentPage
        } of {page.lastPage})
      </div>
    </div>

    <!-- Repositories List -->
    <div
      id="repositories-grid"
      class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-4"
    >
      {
        page.data.map((server) => {
          const formattedName = formatRepositoryName(server.name);
          // Use the repositoryId that was added to the server object
          const repositoryId = server.repositoryId;
          return (
            <RepositoryCard
              server={server}
              formattedName={formattedName}
              category={category}
              repositoryId={repositoryId}
            />
          );
        })
      }
    </div>

    <!-- Pagination -->
    <Pagination
      currentPage={page.currentPage}
      totalPages={page.lastPage}
      baseUrl={`/freedevtools/mcp/${category}/${page.currentPage}/`}
    />

    <!-- Credits Section -->
    <div
      class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700"
    >
      <div class="flex flex-wrap gap-4">
        <a
          href="/freedevtools/mcp/1/"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
        >
          ← Back to MCP Directory
        </a>
        <CreditsButton href="/freedevtools/mcp/credits/" client:load />
      </div>
    </div>
  </ToolContainer>
</BaseLayout>
